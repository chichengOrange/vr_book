<?xml version="1.0" encoding="GB2312" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- ==========================================================  -->
<!-- Configuration for ibatis sqlmap mapping.                    -->
<!-- ==========================================================  -->

<!-- ============================================================================= -->
<!-- This file is generated by <tt>onway-gen-dal</tt>, a DAL (Data Access Layer)    -->
<!-- code generation utility specially developed for <tt>onway</tt> project.        -->
<!--                                                                               -->
<!-- PLEASE DO NOT MODIFY THIS FILE MANUALLY, or else your modification may be     -->
<!-- OVERWRITTEN by someone else. To modify the file, you should go to directory   -->
<!-- <tt>(project-home)/biz/dal/src/conf/dalgen</tt>, and find the corresponding   -->
<!-- configuration files. Modify those files according to your needs, then run     -->
<!-- <tt>onway-gen-dal</tt> to generate this file.                                  -->
<!--                                                                               -->
<!-- @author guangdong.li                                                             -->
<!-- ============================================================================= -->

<sqlMap namespace="onway">
    <!-- ============================================= -->
    <!-- RESULT MAPS                                   -->
    <!-- ============================================= -->

    <!-- result maps for database table dxs_account -->
    <resultMap id="RM-ACCOUNT" class="com.onway.dxsmng.common.dal.dataobject.AccountDO">
		<result property="id" column="ID"  javaType="int" jdbcType="INT"  nullValue="0"/>
		<result property="userId" column="USER_ID"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="accountNo" column="ACCOUNT_NO"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="amount.cent" column="AMOUNT"  javaType="long" jdbcType="DECIMAL" />
		<result property="type" column="TYPE"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="subType" column="SUB_TYPE"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="remark" column="REMARK"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="creater" column="CREATER"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="gmtCreate" column="GMT_CREATE"  javaType="java.util.Date" jdbcType="DATETIME" />
		<result property="modifier" column="MODIFIER"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="gmtModified" column="GMT_MODIFIED"  javaType="java.util.Date" jdbcType="DATETIME" />
		<result property="memo" column="MEMO"  javaType="java.lang.String" jdbcType="VARCHAR" />
    </resultMap>


    <!-- ============================================= -->
    <!-- mapped statements for IbatisAccountDAO -->
    <!-- ============================================= -->
    <!-- mapped statement for IbatisAccountDAO.selectallaccount -->
	<select id="MS-ACCOUNT-SELECTALLACCOUNT" resultClass="java.util.HashMap">
	        select du.CELL,DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') GMT_CREATE,da.*,du.USER_ID,du.USER_NAME 
				from dxs_account da 
				left join dxs_user du  on da.USER_ID = du.USER_ID
				where 1=1 
				<isNotEmpty property="userId">
	    			AND du.USER_ID = #userId# 
	    		</isNotEmpty>
				<isNotEmpty property="username">
	    			AND du.USER_NAME like '%$username$%' 
	    		</isNotEmpty>
	    		<isNotEmpty property="cell">
	    			AND du.CELL like '%$cell$%' 
	    		</isNotEmpty>
	    		<isNotEmpty property="accountno">
	    			AND da.ACCOUNT_NO like '%$accountno$%'
	    		</isNotEmpty>
	    		<isNotEmpty property="type">
	    			AND da.TYPE = #type#
	    		</isNotEmpty>
	    		<isNotEmpty property="starpdate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &gt;  DATE_FORMAT(#starpdate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		<isNotEmpty property="enddate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &lt; DATE_FORMAT(#enddate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		order by da.GMT_CREATE desc 
	    		LIMIT $offset$, $limit$
    </select>

    <!-- mapped statement for IbatisAccountDAO.selectallaccountcount -->
			 <select id="MS-ACCOUNT-SELECTALLACCOUNTCOUNT" resultClass="int">
	        select count(1) from dxs_account da 
				left join dxs_user du  on da.USER_ID = du.USER_ID
				where 1=1 
				<isNotEmpty property="userId">
	    			AND du.USER_ID = #userId# 
	    		</isNotEmpty>
				<isNotEmpty property="username">
	    			AND du.USER_NAME like '%$username$%' 
	    		</isNotEmpty>
	    		<isNotEmpty property="cell">
	    			AND du.CELL like '%$cell$%' 
	    		</isNotEmpty>
	    		<isNotEmpty property="accountno">
	    			AND da.ACCOUNT_NO like '%$accountno$%'
	    		</isNotEmpty>
	    		<isNotEmpty property="type">
	    			AND da.TYPE = #type#
	    		</isNotEmpty>
	    		<isNotEmpty property="starpdate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &gt;  DATE_FORMAT(#starpdate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		<isNotEmpty property="enddate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &lt; DATE_FORMAT(#enddate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisAccountDAO.insertaccount -->
    <insert id="MS-ACCOUNT-INSERTACCOUNT">
    <![CDATA[
        insert into dxs_account(USER_ID,ACCOUNT_NO,AMOUNT,TYPE,SUB_TYPE,CREATER,GMT_CREATE) values (#userId#, #accountNo#, #amount.cent#, #type#, #subType#, #creater#, #gmtCreate#)
    ]]>
	<selectKey resultClass="int" keyProperty="id">
       select last_insert_id() as id
    </selectKey>
    </insert>

    <!-- mapped statement for IbatisAccountDAO.exportaccount -->
	<select id="MS-ACCOUNT-EXPORTACCOUNT" resultClass="java.util.HashMap">
	        SELECT @rownum:=@rownum+1 AS ROWNUM, d.*
				FROM (SELECT @rownum:=0) r,(
				select du.CELL,DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') USERGMT_CREATE,da.*,du.USER_NAME,
				da.TYPE DATYPE,
				da.SUB_TYPE DASUBTYPE 
				from dxs_account da 
				left join dxs_user du  on da.USER_ID = du.USER_ID
				where 1=1 
				<isNotEmpty property="userId">
	    			AND du.USER_ID = #userId# 
	    		</isNotEmpty>
				<isNotEmpty property="username">
	    			AND du.USER_NAME like '%$username$%' 
	    		</isNotEmpty>
	    		<isNotEmpty property="cell">
	    			AND du.CELL like '%$cell$%' 
	    		</isNotEmpty>
	    		<isNotEmpty property="accountno">
	    			AND da.ACCOUNT_NO like '%$accountno$%'
	    		</isNotEmpty>
	    		<isNotEmpty property="type">
	    			AND da.TYPE = #type#
	    		</isNotEmpty>
	    		<isNotEmpty property="starpdate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &gt;  DATE_FORMAT(#starpdate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		<isNotEmpty property="enddate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &lt; DATE_FORMAT(#enddate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		order by da.GMT_CREATE desc ) d
    </select>

    <!-- mapped statement for IbatisAccountDAO.queryUserAccount -->
			 <select id="MS-ACCOUNT-QUERY-USER-ACCOUNT" resultClass="int">
	        SELECT
				SUM(AMOUNT) amount
			FROM dxs_account
			WHERE 1=1
            <isNotEmpty property="userId" prepend="and">
	                 USER_ID = #userId#
	        </isNotEmpty>
	        <isEqual prepend="and" property="type" compareValue = "1">
        			(
        			 SUB_TYPE = 'CALLEDORDER' OR 
        			 SUB_TYPE = 'PROBLEM_ANS' OR 
        			 SUB_TYPE = 'PROBLEM_LIS'
        			)
      		</isEqual>
    </select>

    <!-- mapped statement for IbatisAccountDAO.newAccount -->
    <insert id="MS-ACCOUNT-NEW-ACCOUNT">
    <![CDATA[
        insert into dxs_account(ID,USER_ID,ACCOUNT_NO,AMOUNT,TYPE,SUB_TYPE,REMARK,CREATER,GMT_CREATE,MODIFIER,GMT_MODIFIED,MEMO) values (#id#, #userId#, #accountNo#, #amount.cent#, #type#, #subType#, #remark#, #creater#, CURRENT_TIMESTAMP, #modifier#, CURRENT_TIMESTAMP, #memo#)
    ]]>
	<selectKey resultClass="int" keyProperty="id">
       select last_insert_id() as id
    </selectKey>
    </insert>

    <!-- mapped statement for IbatisAccountDAO.selectStatements -->
	<select id="MS-ACCOUNT-SELECT-STATEMENTS" resultClass="java.util.HashMap">
	        select du.CELL,DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') GMT_CREATE,da.*,du.USER_ID,du.USER_NAME 
				from dxs_account da 
				left join dxs_user du  on da.USER_ID = du.USER_ID
				where 1=1 
	    		<isNotEmpty property="dealType">
	    			AND da.TYPE = #dealType#
	    		</isNotEmpty>
	    		<isNotEmpty property="dealSubType">
	    			AND da.SUB_TYPE = #dealSubType#
	    		</isNotEmpty>
	    		<isNotEmpty property="starpdate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &gt;  DATE_FORMAT(#starpdate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		<isNotEmpty property="enddate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &lt; DATE_FORMAT(#enddate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		order by da.GMT_CREATE desc 
	    		<isNotEmpty property="offset">
	    		LIMIT $offset$, $limit$
	    		</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisAccountDAO.selectStatementscount -->
			 <select id="MS-ACCOUNT-SELECT-STATEMENTSCOUNT" resultClass="int">
	        select count(1) 
				from dxs_account da 
				left join dxs_user du  on da.USER_ID = du.USER_ID
				where 1=1 
	    		<isNotEmpty property="dealType">
	    			AND da.TYPE = #dealType#
	    		</isNotEmpty>
	    		<isNotEmpty property="dealSubType">
	    			AND da.SUB_TYPE = #dealSubType#
	    		</isNotEmpty>
	    		<isNotEmpty property="starpdate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &gt;  DATE_FORMAT(#starpdate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		<isNotEmpty property="enddate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &lt; DATE_FORMAT(#enddate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisAccountDAO.checkInfo -->
			 <select id="MS-ACCOUNT-CHECK-INFO" resultClass="int">
	        SELECT
				COUNT(1)
			FROM dxs_account
			WHERE 1=1
            <isNotEmpty property="userId" prepend="and">
	                 USER_ID = #userId#
	        </isNotEmpty>
	        <isNotEmpty property="subType" prepend="and">
	                 SUB_TYPE = #subType#
	        </isNotEmpty>
    </select>

    <!-- mapped statement for IbatisAccountDAO.plantFormPresentRecord -->
	<select id="MS-ACCOUNT-PLANT-FORM-PRESENT-RECORD" resultClass="java.util.HashMap">
	        select du.CELL,DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') GMT_CREATE,da.*,du.USER_ID,du.USER_NAME, 
				du.NICK_NAME
				from dxs_account da 
				left join dxs_user du  on da.USER_ID = du.USER_ID
				where 1=1 AND
				da.SUB_TYPE IN ('CERTIFICATION','INFO','TASK_POINT','TASK_COIN','INVITE_POINT','SIGN','REGISTER_POINT')
				<isNotEmpty property="userId">
	    			AND du.USER_ID = #userId# 
	    		</isNotEmpty>
				<isNotEmpty property="nickname">
	    			AND du.NICK_NAME like '%$nickname$%' 
	    		</isNotEmpty>
	    		<isNotEmpty property="cell">
	    			AND du.CELL like '%$cell$%' 
	    		</isNotEmpty>
	    		<isNotEmpty property="type">
	    			AND da.TYPE = #type#
	    		</isNotEmpty>
	    		<isNotEmpty property="starpdate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &gt;  DATE_FORMAT(#starpdate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		<isNotEmpty property="enddate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &lt; DATE_FORMAT(#enddate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		order by da.GMT_CREATE desc 
	    		<isNotEmpty property="offset">
	    			LIMIT $offset$, $limit$
	    		</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisAccountDAO.plantFormPresentRecordCount -->
			 <select id="MS-ACCOUNT-PLANT-FORM-PRESENT-RECORD-COUNT" resultClass="int">
	        select count(1) from dxs_account da 
				left join dxs_user du  on da.USER_ID = du.USER_ID
				where 1=1 AND
				da.SUB_TYPE IN ('CERTIFICATION','INFO','TASK_POINT','TASK_COIN','INVITE_POINT','SIGN','REGISTER_POINT')
				<isNotEmpty property="userId">
	    			AND du.USER_ID = #userId# 
	    		</isNotEmpty>
				<isNotEmpty property="nickname">
	    			AND du.NICK_NAME like '%$nickname$%' 
	    		</isNotEmpty>
	    		<isNotEmpty property="cell">
	    			AND du.CELL like '%$cell$%' 
	    		</isNotEmpty>
	    		<isNotEmpty property="type">
	    			AND da.TYPE = #type#
	    		</isNotEmpty>
	    		<isNotEmpty property="starpdate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &gt;  DATE_FORMAT(#starpdate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		<isNotEmpty property="enddate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &lt; DATE_FORMAT(#enddate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisAccountDAO.plantFormReceiveRecord -->
	<select id="MS-ACCOUNT-PLANT-FORM-RECEIVE-RECORD" resultClass="java.util.HashMap">
	        select du.CELL,DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') GMT_CREATE,da.*,du.USER_ID,du.USER_NAME, 
				du.NICK_NAME
				from dxs_account da 
				left join dxs_user du  on da.USER_ID = du.USER_ID
				where 1=1 
				<isNotEmpty prepend="" property="subType"> 
				 AND da.SUB_TYPE IN
					<iterate property="subType" open="(" close=")" conjunction="," > 
		        		#subType[]# 
		        	</iterate>
		        </isNotEmpty>
	    		<isNotEmpty property="starpdate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &gt;  DATE_FORMAT(#starpdate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		<isNotEmpty property="enddate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &lt; DATE_FORMAT(#enddate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		order by da.GMT_CREATE desc 
	    		<isNotEmpty property="offset">
	    			LIMIT $offset$, $limit$
	    		</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisAccountDAO.plantFormReceiveRecordCount -->
			 <select id="MS-ACCOUNT-PLANT-FORM-RECEIVE-RECORD-COUNT" resultClass="int">
	        select count(1) 
				from dxs_account da 
				left join dxs_user du  on da.USER_ID = du.USER_ID
				where 1=1 
				<isNotEmpty prepend="" property="subType"> 
				 AND da.SUB_TYPE IN
					<iterate property="subType" open="(" close=")" conjunction="," > 
		        		#subType[]# 
		        	</iterate>
		        </isNotEmpty>
	    		<isNotEmpty property="starpdate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &gt;  DATE_FORMAT(#starpdate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
	    		<isNotEmpty property="enddate">
	    			AND DATE_FORMAT(da.GMT_CREATE,'%Y-%m-%d %H:%i:%s') &lt; DATE_FORMAT(#enddate#,'%Y-%m-%d %H:%i:%s')
	    		</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisAccountDAO.selectByAccountNoAndSubType -->
			 <select id="MS-ACCOUNT-SELECT-BY-ACCOUNT-NO-AND-SUB-TYPE" resultClass="java.util.HashMap">
	        select *
				from dxs_account 
				where 1=1 
				<isNotEmpty property="accountNo">
	    			AND ACCOUNT_NO = #accountNo# 
	    		</isNotEmpty>
				<isNotEmpty property="subType">
	    			AND SUB_TYPE = #subType# 
	    		</isNotEmpty>
	    		<isNotEmpty property="userId">
	    			AND USER_ID = #userId# 
	    		</isNotEmpty>
    </select>

</sqlMap>