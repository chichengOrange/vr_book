/**
 * 
 */
package com.onway.core.service.impl;

import com.onway.core.service.OptionOperationService;
import com.onway.fyapp.common.dal.daointerface.OptionDAO;
import com.onway.fyapp.common.dal.dataobject.OptionDO;
import com.onway.platform.common.base.BaseResult;
import com.onway.platform.common.service.template.AbstractServiceImpl;
import com.onway.platform.common.service.template.ServiceCheckCallback;
import com.onway.platform.common.service.util.AssertUtil;
import com.onway.utils.emoji.EmojiUtil;

public class OptionOperationServiceImpl extends AbstractServiceImpl
		implements OptionOperationService {

	private OptionDAO optionDAO;

	public void setOptionDAO(OptionDAO optionDAO) {
		this.optionDAO = optionDAO;
	}

	/**
	 * 新增反馈
	 */
	public BaseResult newOption( final String userId, final String title, final String content) {
		final BaseResult result = new BaseResult(false);
		serviceTemplate.executeWithoutTransaction(result,
				new ServiceCheckCallback() {

					@Override
					public void check() {
						AssertUtil.notBlank(userId, "用户未登录");
						AssertUtil.notBlank(content, "内容为空");
					}

					@Override
					public void executeService() {
						String contentConvert = EmojiUtil.emojiConvert1(content);

						OptionDO optionDO = new OptionDO();
						optionDO.setTitle(title);
						optionDO.setUserId(userId);
						optionDO.setContent(contentConvert);

						if (optionDAO.newOption(optionDO) > 0) {
							result.setSuccess(true);
						}
					}
				});
		return result;
	}

}
