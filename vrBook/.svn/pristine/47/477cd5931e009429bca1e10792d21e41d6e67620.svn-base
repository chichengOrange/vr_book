<?xml version="1.0" encoding="UTF-8"?>
<table sqlname="vr_download_log">

	<operation name="insert">
		<sql>
			INSERT INTO vr_download_log(
				ID,
				USER_ID,
				BOOK_ID,
				INTERFACES,
				DOWNLOAD_SPEED,
				IS_SUCCESS,
				GMT_CREATE,
				GMT_MODIFIED
			)VALUES(
				?,?,?,?,?,?,CURRENT_TIMESTAMP,CURRENT_TIMESTAMP
			)
		</sql>
	</operation>
	
	<!-- 查询用户最近一条下载记录 -->
	<operation name="queryByUserIdAndBookId">
		<extraparams>
			<param name="userId" javatype="java.lang.String"/>
			<param name="bookId" javatype="java.lang.String"/>
		</extraparams>
		<sql>
			SELECT * FROM vr_download_log
		</sql>
		<sqlmap>
			SELECT
				ID,
				USER_ID,
				BOOK_ID,
				INTERFACES,
				DOWNLOAD_SPEED,
				IS_SUCCESS,
				GMT_CREATE,
				GMT_MODIFIED
			FROM vr_download_log
			WHERE 1=1
			<isNotEmpty property="userId" prepend="and">
					USER_ID = #userId#
			</isNotEmpty>
			<isNotEmpty property="bookId" prepend="and">
					BOOK_ID = #bookId#
			</isNotEmpty>
			ORDER BY GMT_MODIFIED DESC
			LIMIT 0,1
		</sqlmap>
	</operation>
	
	<!-- 更新下载界面 -->
	<operation name="updateByUserId">
		<sql>
			UPDATE vr_download_log SET 
			GMT_MODIFIED = CURRENT_TIMESTAMP,
			INTERFACES = ?
			WHERE ID = ?
		</sql>
		
	</operation>

	<!-- 添加平均下载速度 -->
	<operation name="updateSpeedByUserId">
		<sql>
			UPDATE vr_download_log SET 
			GMT_MODIFIED = CURRENT_TIMESTAMP,
			DOWNLOAD_SPEED = ?,
			IS_SUCCESS = ?
			WHERE ID = ?
		</sql>
		
	</operation>
</table>