<?xml version="1.0" encoding="UTF-8"?>
<table sqlname="vr_order">
<column name="PRICE" javatype="com.onway.common.lang.Money" />
	<operation name="insert">
		<sql>
			INSERT INTO vr_order(
				ORDER_ID,
				USER_ID,
				PAY_STATUS,
				BOOK_ID,
				PRICE,
				GMT_CREATE,
				GMT_MODIFIED
			)VALUES(
				?,?,?,?,?,CURRENT_TIMESTAMP,CURRENT_TIMESTAMP
			)
		</sql>
	</operation>
	

	<operation name="queryOrderByItem">
		<extraparams>
			<param name="orderId" javatype="java.lang.String"/>
			<param name="userId" javatype="java.lang.String"/>
			<param name="status" javatype="java.lang.String"/>
			<param name="bookId" javatype="java.lang.String"/>
		</extraparams>
		<sql>
		    SELECT * FROM vr_order
		</sql>
		<sqlmap>
			<![CDATA[
				SELECT
					ID,
					ORDER_ID,
					USER_ID,
					PAY_STATUS,
					BOOK_ID,
					PRICE,
					GMT_CREATE,
					GMT_MODIFIED
				FROM vr_order
				WHERE 1 = 1 
				<isNotEmpty property="orderId" prepend="and">
					ORDER_ID = #orderId#
				</isNotEmpty>
				<isNotEmpty property="userId" prepend="and">
					USER_ID = #userId#
				</isNotEmpty>
				<isNotEmpty property="status" prepend="and">
					PAY_STATUS = #status#
				</isNotEmpty>
				<isNotEmpty property="bookId" prepend="and">
					BOOK_ID = #bookId#
				</isNotEmpty>
			]]>
		</sqlmap>
	</operation>
	
	<operation name="queryOrderByUserId" multiplicity="many" resultClass="java.util.HashMap">
		<extraparams>
			<param name="userId" javatype="java.lang.String"/>
			<param name="status" javatype="java.lang.String"/>
		</extraparams>
		<sql>
		    SELECT * FROM vr_order
		</sql>
		<sqlmap>
			<![CDATA[
				SELECT
					b.BOOK_ID bookId,
					b.BOOK_NAME bookName,
					b.BOOK_IMG bookImg,
					b.BOOK_AUTHOR author,
					b.BOOK_PUBLISH bookPublish,
					b.BOOK_SIZE bookSize,
					b.BOOK_HEAT bookHeat,
					b.DOWNLOAD_URL downUrl,
					b.DOWNLOAD_COUNT downCount,
					b.PRICE price,
					b.DISTRIBUTOR distributor
				FROM vr_order o LEFT JOIN vr_book b ON o.BOOK_ID = b.BOOK_ID
				WHERE 1 = 1 

				<isNotEmpty property="userId" prepend="and">
					o.USER_ID = #userId#
				</isNotEmpty>
				<isNotEmpty property="status" prepend="and">
					o.PAY_STATUS = #status#
				</isNotEmpty>
			]]>
		</sqlmap>
	</operation>
	
	<operation name="updateStatusByOrderId">
		<sql>
			UPDATE vr_order SET
			PAY_STATUS=?,
			GMT_MODIFIED=CURRENT_TIMESTAMP
			WHERE ORDER_ID = ?
		</sql>
	</operation>
</table>